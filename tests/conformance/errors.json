{
  "type": "bonjson-test",
  "version": "1.0.0",
  "//": "Error handling tests for invalid encodings and decode failures",
  "tests": [
    {
      "//": "Truncated integer types - data ends before all bytes received",
      "name": "truncated_uint8",
      "type": "decode_error",
      "input_bytes": "70",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint16",
      "type": "decode_error",
      "input_bytes": "7102",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint24",
      "type": "decode_error",
      "input_bytes": "720202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint32",
      "type": "decode_error",
      "input_bytes": "73020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint40",
      "type": "decode_error",
      "input_bytes": "7402020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint48",
      "type": "decode_error",
      "input_bytes": "750202020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint56",
      "type": "decode_error",
      "input_bytes": "76020202020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint64",
      "type": "decode_error",
      "input_bytes": "7702020202020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint8",
      "type": "decode_error",
      "input_bytes": "78",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint16",
      "type": "decode_error",
      "input_bytes": "7902",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint24",
      "type": "decode_error",
      "input_bytes": "7a0202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint32",
      "type": "decode_error",
      "input_bytes": "7b020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint40",
      "type": "decode_error",
      "input_bytes": "7c02020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint48",
      "type": "decode_error",
      "input_bytes": "7d0202020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint56",
      "type": "decode_error",
      "input_bytes": "7e020202020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint64",
      "type": "decode_error",
      "input_bytes": "7f02020202020202",
      "expected_error": "truncated"
    },
    {
      "//": "Truncated float types",
      "name": "truncated_float16",
      "type": "decode_error",
      "input_bytes": "6a00",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_float32",
      "type": "decode_error",
      "input_bytes": "6b000000",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_float64",
      "type": "decode_error",
      "input_bytes": "6c00000000000000",
      "expected_error": "truncated"
    },
    {
      "//": "Truncated BigNumber",
      "name": "truncated_bignumber_1",
      "type": "decode_error",
      "input_bytes": "6908",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_bignumber_2",
      "type": "decode_error",
      "input_bytes": "691000",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_bignumber_3",
      "type": "decode_error",
      "input_bytes": "69180000",
      "expected_error": "truncated"
    },
    {
      "//": "Truncated short strings",
      "name": "truncated_string1",
      "type": "decode_error",
      "input_bytes": "81",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_string2",
      "type": "decode_error",
      "input_bytes": "8261",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_string3",
      "type": "decode_error",
      "input_bytes": "836161",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_string15",
      "type": "decode_error",
      "input_bytes": "8f6161616161616161616161616161",
      "expected_error": "truncated"
    },
    {
      "//": "Invalid (reserved) type codes",
      "name": "invalid_type_code_65",
      "type": "decode_error",
      "input_bytes": "650000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_66",
      "type": "decode_error",
      "input_bytes": "660000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_67",
      "type": "decode_error",
      "input_bytes": "670000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_90",
      "type": "decode_error",
      "input_bytes": "900000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_91",
      "type": "decode_error",
      "input_bytes": "910000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_92",
      "type": "decode_error",
      "input_bytes": "920000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_93",
      "type": "decode_error",
      "input_bytes": "930000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_94",
      "type": "decode_error",
      "input_bytes": "940000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_95",
      "type": "decode_error",
      "input_bytes": "950000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_96",
      "type": "decode_error",
      "input_bytes": "960000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_97",
      "type": "decode_error",
      "input_bytes": "970000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_98",
      "type": "decode_error",
      "input_bytes": "980000000000000000000000ff",
      "expected_error": "invalid_type_code"
    },
    {
      "//": "Unclosed container errors",
      "name": "unclosed_object",
      "type": "decode_error",
      "input_bytes": "9a",
      "expected_error": "unclosed_container"
    },
    {
      "name": "unclosed_object_with_nested_object",
      "type": "decode_error",
      "input_bytes": "9a809a9b",
      "expected_error": "unclosed_container"
    },
    {
      "name": "unclosed_object_with_nested_array",
      "type": "decode_error",
      "input_bytes": "9a80999b",
      "expected_error": "unclosed_container"
    },
    {
      "name": "unclosed_array",
      "type": "decode_error",
      "input_bytes": "99",
      "expected_error": "unclosed_container"
    },
    {
      "name": "unclosed_array_with_nested_array",
      "type": "decode_error",
      "input_bytes": "99999b",
      "expected_error": "unclosed_container"
    },
    {
      "name": "unclosed_array_with_nested_object",
      "type": "decode_error",
      "input_bytes": "999a9b",
      "expected_error": "unclosed_container"
    },
    {
      "//": "NUL character in string (rejected by default)",
      "name": "nul_in_string1",
      "type": "decode_error",
      "input_bytes": "8100",
      "expected_error": "nul_character"
    },
    {
      "name": "nul_in_string_middle",
      "type": "decode_error",
      "input_bytes": "826100",
      "expected_error": "nul_character"
    },
    {
      "name": "nul_in_string_start",
      "type": "decode_error",
      "input_bytes": "820061",
      "expected_error": "nul_character"
    },
    {
      "name": "nul_in_long_string",
      "type": "decode_error",
      "input_bytes": "68407468697320697320612073747200676e67",
      "expected_error": "nul_character"
    },
    {
      "//": "BigNumber NaN/Infinity (rejected by default)",
      "//note": "When sig_len=0, exp_len encodes: 00=zero, 01=infinity, 10=NaN quiet, 11=NaN signaling",
      "name": "bignumber_infinity_positive",
      "type": "decode_error",
      "input_bytes": "6902",
      "expected_error": "invalid_data"
    },
    {
      "name": "bignumber_infinity_negative",
      "type": "decode_error",
      "input_bytes": "6903",
      "expected_error": "invalid_data"
    },
    {
      "name": "bignumber_nan_quiet",
      "type": "decode_error",
      "input_bytes": "6904",
      "expected_error": "invalid_data"
    },
    {
      "name": "bignumber_nan_signaling",
      "type": "decode_error",
      "input_bytes": "6906",
      "expected_error": "invalid_data"
    },
    {
      "//": "Encoding errors - NaN and Infinity rejected by default",
      "name": "encode_nan",
      "type": "encode_error",
      "input": {"$number": "NaN"},
      "expected_error": "invalid_data"
    },
    {
      "name": "encode_infinity",
      "type": "encode_error",
      "input": {"$number": "Infinity"},
      "expected_error": "invalid_data"
    },
    {
      "name": "encode_neg_infinity",
      "type": "encode_error",
      "input": {"$number": "-Infinity"},
      "expected_error": "invalid_data"
    },
    {
      "//": "=== Non-string object keys (must be rejected) ===",
      "//note": "Object keys must be strings. Any other type as a key is invalid.",
      "name": "object_key_integer",
      "type": "decode_error",
      "input_bytes": "9a 01 00 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_null",
      "type": "decode_error",
      "input_bytes": "9a 6d 00 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_true",
      "type": "decode_error",
      "input_bytes": "9a 6f 00 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_false",
      "type": "decode_error",
      "input_bytes": "9a 6e 00 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_array",
      "type": "decode_error",
      "input_bytes": "9a 99 9b 00 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_object",
      "type": "decode_error",
      "input_bytes": "9a 9a 9b 00 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_float16",
      "type": "decode_error",
      "input_bytes": "9a 6a 00 00 00 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_float32",
      "type": "decode_error",
      "input_bytes": "9a 6b 00 00 00 00 00 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_float64",
      "type": "decode_error",
      "input_bytes": "9a 6c 00 00 00 00 00 00 00 00 00 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "//": "=== Additional invalid UTF-8 patterns ===",
      "name": "invalid_utf8_fe_byte",
      "type": "decode_error",
      "input_bytes": "81 fe",
      "expected_error": "invalid_utf8"
    },
    {
      "name": "invalid_utf8_ff_byte",
      "type": "decode_error",
      "input_bytes": "81 ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Two-byte sequence followed by invalid continuation (0x00 instead of 0x80-0xbf)",
      "name": "invalid_utf8_bad_continuation",
      "type": "decode_error",
      "input_bytes": "82 c2 00",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Two-byte sequence followed by another start byte instead of continuation",
      "name": "invalid_utf8_start_instead_of_continuation",
      "type": "decode_error",
      "input_bytes": "82 c2 c2",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Lone continuation byte 0xbf",
      "name": "invalid_utf8_lone_continuation_bf",
      "type": "decode_error",
      "input_bytes": "81 bf",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Valid UTF-8 followed by invalid in same string",
      "name": "invalid_utf8_valid_then_invalid",
      "type": "decode_error",
      "input_bytes": "83 61 62 80",
      "expected_error": "invalid_utf8"
    },

    {
      "//": "=== UTF-8 split across chunk boundaries ===",
      "//note": "Each chunk must contain valid UTF-8. Splitting a multi-byte character across chunks is invalid."
    },
    {
      "//": "2-byte UTF-8 char split: 'Ã¼' (U+00FC = C3 BC) split after first byte",
      "//note2": "Chunk1: length=1, cont=1 â†’ 0x06, data=C3. Chunk2: length=1, cont=0 â†’ 0x04, data=BC",
      "name": "invalid_utf8_chunk_split_2byte",
      "type": "decode_error",
      "input_bytes": "68 06 c3 04 bc",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "3-byte UTF-8 char split: 'ä¸–' (U+4E16 = E4 B8 96) split after first byte",
      "//note2": "Chunk1: length=1, cont=1 â†’ 0x06, data=E4. Chunk2: length=2, cont=0 â†’ 0x08, data=B896",
      "name": "invalid_utf8_chunk_split_3byte_1",
      "type": "decode_error",
      "input_bytes": "68 06 e4 08 b896",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "3-byte UTF-8 char split after 2 bytes: 'ä¸–' (E4 B8 | 96)",
      "//note2": "Chunk1: length=2, cont=1 â†’ 0x0a, data=E4B8. Chunk2: length=1, cont=0 â†’ 0x04, data=96",
      "name": "invalid_utf8_chunk_split_3byte_2",
      "type": "decode_error",
      "input_bytes": "68 0a e4b8 04 96",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "4-byte UTF-8 emoji split: 'ðŸ˜€' (U+1F600 = F0 9F 98 80) split after first byte",
      "//note2": "Chunk1: length=1, cont=1 â†’ 0x06, data=F0. Chunk2: length=3, cont=0 â†’ 0x0c, data=9F9880",
      "name": "invalid_utf8_chunk_split_4byte_1",
      "type": "decode_error",
      "input_bytes": "68 06 f0 0c 9f9880",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "4-byte UTF-8 emoji split in middle: 'ðŸ˜€' (F0 9F | 98 80)",
      "//note2": "Chunk1: length=2, cont=1 â†’ 0x0a, data=F09F. Chunk2: length=2, cont=0 â†’ 0x08, data=9880",
      "name": "invalid_utf8_chunk_split_4byte_2",
      "type": "decode_error",
      "input_bytes": "68 0a f09f 08 9880",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Valid string then invalid UTF-8 in next chunk",
      "//note2": "Chunk1: 'hi' (2 bytes) with cont. Chunk2: lone continuation byte 0x80",
      "name": "invalid_utf8_second_chunk",
      "type": "decode_error",
      "input_bytes": "68 0a 6869 04 80",
      "expected_error": "invalid_utf8"
    },

    {
      "//": "=== Malformed BigNumber headers ===",
      "//note": "BigNumber header: [sig_len:5][exp_len:2][negative:1]",
      "name": "bignumber_max_sig_len_truncated",
      "type": "decode_error",
      "input_bytes": "69 f8",
      "expected_error": "truncated"
    },
    {
      "//": "Significand claims 5 bytes but only 2 provided",
      "name": "bignumber_sig_partial",
      "type": "decode_error",
      "input_bytes": "69 28 01 02",
      "expected_error": "truncated"
    },
    {
      "//": "Exponent claims 2 bytes but only 1 provided (sig_len=1, exp_len=2)",
      "name": "bignumber_exp_partial",
      "type": "decode_error",
      "input_bytes": "69 0c 01 02",
      "expected_error": "truncated"
    },
    {
      "//": "=== Standalone container end marker (invalid at top level) ===",
      "name": "standalone_container_end",
      "type": "decode_error",
      "input_bytes": "9b",
      "expected_error": "invalid_type_code"
    },
    {
      "//": "=== Empty input ===",
      "name": "empty_input",
      "type": "decode_error",
      "input_bytes": "",
      "expected_error": "truncated"
    },
    {
      "//": "=== Malformed object structures ===",
      "//note": "Object with key but missing value before end marker",
      "name": "object_key_without_value",
      "type": "decode_error",
      "input_bytes": "9a 81 61 9b",
      "expected_error": "truncated"
    },
    {
      "//": "Object with long string key but missing value",
      "name": "object_long_key_without_value",
      "type": "decode_error",
      "input_bytes": "9a 68 40 6b6579206e616d6520686572652121 9b",
      "expected_error": "truncated"
    },
    {
      "//": "Object truncated after key (no value, no end)",
      "name": "object_truncated_after_key",
      "type": "decode_error",
      "input_bytes": "9a 81 61",
      "expected_error": "truncated"
    },
    {
      "//": "Object with value but missing key",
      "name": "object_value_without_key",
      "type": "decode_error",
      "input_bytes": "9a 01 9b",
      "expected_error": "invalid_object_key"
    },
    {
      "//": "=== Container end edge cases ===",
      "//note": "Extra container end marker after valid array",
      "name": "double_container_end_array",
      "type": "decode_error",
      "input_bytes": "99 9b 9b",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Extra container end after array with element",
      "name": "double_container_end_array_with_element",
      "type": "decode_error",
      "input_bytes": "99 01 9b 9b",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Extra container end after valid object",
      "name": "double_container_end_object",
      "type": "decode_error",
      "input_bytes": "9a 9b 9b",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Container end inside array value position",
      "name": "container_end_as_array_element",
      "type": "decode_error",
      "input_bytes": "99 01 9b 02 9b",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "=== Length field edge cases ===",
      "//note": "Non-canonical length encoding - value 63 encoded with trailing zero byte",
      "name": "non_canonical_length_63_with_extra_byte",
      "type": "decode_error",
      "input_bytes": "68 f9 00",
      "expected_error": "non_canonical_length"
    },
    {
      "//": "Length field claiming more data than available",
      "name": "length_exceeds_data",
      "type": "decode_error",
      "input_bytes": "68 80 61",
      "expected_error": "truncated"
    }
  ]
}
