{
  "type": "bonjson-test",
  "version": "1.0.0",
  "//": "Error handling tests for invalid encodings and decode failures",
  "tests": [
    {
      "//": "Truncated integer types - data ends before all bytes received",
      "name": "truncated_uint8",
      "type": "decode_error",
      "input_bytes": "a8",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint16",
      "type": "decode_error",
      "input_bytes": "a902",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint32",
      "type": "decode_error",
      "input_bytes": "aa020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_uint64",
      "type": "decode_error",
      "input_bytes": "ab02020202020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint8",
      "type": "decode_error",
      "input_bytes": "ac",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint16",
      "type": "decode_error",
      "input_bytes": "ad02",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint32",
      "type": "decode_error",
      "input_bytes": "ae020202",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_sint64",
      "type": "decode_error",
      "input_bytes": "af02020202020202",
      "expected_error": "truncated"
    },
    {
      "//": "Truncated float types",
      "name": "truncated_float32",
      "type": "decode_error",
      "input_bytes": "b0000000",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_float64",
      "type": "decode_error",
      "input_bytes": "b100000000000000",
      "expected_error": "truncated"
    },
    {
      "//": "Truncated BigNumber (zigzag LEB128 metadata + LE magnitude format)",
      "name": "truncated_bignumber_no_exponent",
      "type": "decode_error",
      "input_bytes": "b2",
      "expected_error": "truncated"
    },
    {
      "//": "Exponent byte has continuation bit set but no following byte",
      "name": "truncated_bignumber_exponent_incomplete",
      "type": "decode_error",
      "input_bytes": "b280",
      "expected_error": "truncated"
    },
    {
      "//": "Exponent complete (0), signed_length byte has continuation bit but no following byte",
      "name": "truncated_bignumber_signed_length_incomplete",
      "type": "decode_error",
      "input_bytes": "b20080",
      "expected_error": "truncated"
    },
    {
      "//": "signed_length says 2 magnitude bytes but only 1 follows",
      "name": "truncated_bignumber_magnitude",
      "type": "decode_error",
      "input_bytes": "b20004ff",
      "expected_error": "truncated"
    },
    {
      "//": "Magnitude has trailing zero byte (non-normalized): signed_length=+2, magnitude=01 00",
      "name": "non_normalized_bignumber_magnitude",
      "type": "decode_error",
      "input_bytes": "b200040100",
      "expected_error": "invalid_data"
    },
    {
      "//": "Truncated short strings",
      "name": "truncated_string1",
      "type": "decode_error",
      "input_bytes": "66",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_string2",
      "type": "decode_error",
      "input_bytes": "6761",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_string3",
      "type": "decode_error",
      "input_bytes": "6a6161",
      "expected_error": "truncated"
    },
    {
      "name": "truncated_string15",
      "type": "decode_error",
      "input_bytes": "746161616161616161616161616161",
      "expected_error": "truncated"
    },
    {
      "//": "Truncated long string (no terminator)",
      "name": "truncated_long_string",
      "type": "decode_error",
      "input_bytes": "ff6a656c6c6f",
      "expected_error": "truncated"
    },
    {
      "//": "Invalid (reserved) type codes â€” codes in the 0xbb-0xf4 range are reserved",
      "name": "invalid_type_code_c9",
      "type": "decode_error",
      "input_bytes": "c9",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_e8",
      "type": "decode_error",
      "input_bytes": "e8",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_e9",
      "type": "decode_error",
      "input_bytes": "e9",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_f0",
      "type": "decode_error",
      "input_bytes": "f0",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_bb",
      "type": "decode_error",
      "input_bytes": "bb",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_be",
      "type": "decode_error",
      "input_bytes": "be",
      "expected_error": "invalid_type_code"
    },
    {
      "name": "invalid_type_code_bf",
      "type": "decode_error",
      "input_bytes": "bf",
      "expected_error": "invalid_type_code"
    },
    {
      "//": "Container end marker at top level (no container to close)",
      "name": "unexpected_container_end",
      "type": "decode_error",
      "input_bytes": "b6",
      "expected_error": "invalid_type_code"
    },
    {
      "//": "=== Truncated/unclosed container errors ===",
      "//note": "Containers use delimiter-terminated encoding: b7/b8 + children + b6"
    },
    {
      "//": "Array with no end marker and no content",
      "name": "unclosed_array_empty",
      "type": "decode_error",
      "input_bytes": "b7",
      "expected_error": "truncated"
    },
    {
      "//": "Object with no end marker and no content",
      "name": "unclosed_object_empty",
      "type": "decode_error",
      "input_bytes": "b8",
      "expected_error": "truncated"
    },
    {
      "//": "Array with element but no end marker",
      "name": "unclosed_array_with_element",
      "type": "decode_error",
      "input_bytes": "b701",
      "expected_error": "truncated"
    },
    {
      "//": "Object with key-value pair but no end marker",
      "name": "unclosed_object_with_pair",
      "type": "decode_error",
      "input_bytes": "b8666101",
      "expected_error": "truncated"
    },
    {
      "//": "Nested array where inner is truncated",
      "name": "nested_array_inner_truncated",
      "type": "decode_error",
      "input_bytes": "b7b7",
      "expected_error": "truncated"
    },
    {
      "//": "Nested object where inner is truncated",
      "name": "nested_object_inner_truncated",
      "type": "decode_error",
      "input_bytes": "b865b8",
      "expected_error": "truncated"
    },
    {
      "//": "NUL character in string (rejected by default)",
      "name": "nul_in_string1",
      "type": "decode_error",
      "input_bytes": "6600",
      "expected_error": "nul_character"
    },
    {
      "name": "nul_in_string_middle",
      "type": "decode_error",
      "input_bytes": "676100",
      "expected_error": "nul_character"
    },
    {
      "name": "nul_in_string_start",
      "type": "decode_error",
      "input_bytes": "670061",
      "expected_error": "nul_character"
    },
    {
      "//": "NUL in long string (ff-terminated format)",
      "name": "nul_in_long_string",
      "type": "decode_error",
      "input_bytes": "ff746a6b7300ff",
      "expected_error": "nul_character"
    },
    {
      "//": "Float64 NaN rejected",
      "name": "float64_nan_rejected",
      "type": "decode_error",
      "input_bytes": "b1000000000000fa7f",
      "expected_error": "invalid_data",
      "options": {"nan_infinity_behavior": "reject"}
    },
    {
      "//": "Float64 positive infinity rejected",
      "name": "float64_infinity_positive_rejected",
      "type": "decode_error",
      "input_bytes": "b1000000000000f07f",
      "expected_error": "invalid_data",
      "options": {"nan_infinity_behavior": "reject"}
    },
    {
      "//": "Float64 negative infinity rejected",
      "name": "float64_infinity_negative_rejected",
      "type": "decode_error",
      "input_bytes": "b1000000000000f0ff",
      "expected_error": "invalid_data",
      "options": {"nan_infinity_behavior": "reject"}
    },
    {
      "//": "Float32 NaN rejected",
      "name": "float32_nan_rejected",
      "type": "decode_error",
      "input_bytes": "b00000c07f",
      "expected_error": "invalid_data",
      "options": {"nan_infinity_behavior": "reject"}
    },
    {
      "//": "Float32 positive infinity rejected",
      "name": "float32_infinity_positive_rejected",
      "type": "decode_error",
      "input_bytes": "b00000807f",
      "expected_error": "invalid_data",
      "options": {"nan_infinity_behavior": "reject"}
    },
    {
      "//": "Float32 negative infinity rejected",
      "name": "float32_infinity_negative_rejected",
      "type": "decode_error",
      "input_bytes": "b0000080ff",
      "expected_error": "invalid_data",
      "options": {"nan_infinity_behavior": "reject"}
    },
    {
      "//": "Encoding errors - NaN and Infinity rejected by default",
      "name": "encode_nan",
      "type": "encode_error",
      "input": {
        "$number": "NaN"
      },
      "expected_error": "invalid_data",
      "options": {"nan_infinity_behavior": "reject"}
    },
    {
      "name": "encode_infinity",
      "type": "encode_error",
      "input": {
        "$number": "Infinity"
      },
      "expected_error": "invalid_data",
      "options": {"nan_infinity_behavior": "reject"}
    },
    {
      "name": "encode_neg_infinity",
      "type": "encode_error",
      "input": {
        "$number": "-Infinity"
      },
      "expected_error": "invalid_data",
      "options": {"nan_infinity_behavior": "reject"}
    },
    {
      "//": "=== Non-string object keys (must be rejected) ===",
      "//note": "Object format: b8 + key-value pairs + b6. Keys must be strings."
    },
    {
      "name": "object_key_integer",
      "type": "decode_error",
      "input_bytes": "b80100b6",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_null",
      "type": "decode_error",
      "input_bytes": "b8b300b6",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_true",
      "type": "decode_error",
      "input_bytes": "b8b500b6",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_false",
      "type": "decode_error",
      "input_bytes": "b8b400b6",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_array",
      "type": "decode_error",
      "input_bytes": "b8b7b600b6",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_object",
      "type": "decode_error",
      "input_bytes": "b8b8b600b6",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_float32",
      "type": "decode_error",
      "input_bytes": "b8b00000000000b6",
      "expected_error": "invalid_object_key"
    },
    {
      "name": "object_key_float64",
      "type": "decode_error",
      "input_bytes": "b8b1000000000000000000b6",
      "expected_error": "invalid_object_key"
    },
    {
      "//": "=== Additional invalid UTF-8 patterns ===",
      "name": "invalid_utf8_fe_byte",
      "type": "decode_error",
      "input_bytes": "66fe",
      "expected_error": "invalid_utf8"
    },
    {
      "name": "invalid_utf8_ff_byte",
      "type": "decode_error",
      "input_bytes": "66ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Two-byte sequence followed by invalid continuation (0x00 instead of 0x80-0xbf)",
      "name": "invalid_utf8_bad_continuation",
      "type": "decode_error",
      "input_bytes": "67c200",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Two-byte sequence followed by another start byte instead of continuation",
      "name": "invalid_utf8_start_instead_of_continuation",
      "type": "decode_error",
      "input_bytes": "67c2c2",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Lone continuation byte 0xbf",
      "name": "invalid_utf8_lone_continuation_bf",
      "type": "decode_error",
      "input_bytes": "66bf",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Valid UTF-8 followed by invalid in same string (short string length 3: 0x68 = 0x65+3)",
      "name": "invalid_utf8_valid_then_invalid",
      "type": "decode_error",
      "input_bytes": "68616280",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Lone continuation byte in long string",
      "name": "invalid_utf8_long_string_lone_continuation",
      "type": "decode_error",
      "input_bytes": "ff6a6b80ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "=== Empty input ===",
      "name": "empty_input",
      "type": "decode_error",
      "input_bytes": "",
      "expected_error": "truncated"
    },
    {
      "//": "=== Malformed object structures ===",
      "//note": "Object format: b8 + string-key value-pairs + b6"
    },
    {
      "//": "Object with key but missing value (truncated before value)",
      "name": "object_key_without_value",
      "type": "decode_error",
      "input_bytes": "b86661",
      "expected_error": "truncated"
    },
    {
      "//": "Object with long string key but missing value",
      "name": "object_long_key_without_value",
      "type": "decode_error",
      "input_bytes": "b8ff6b657bff",
      "expected_error": "truncated"
    },
    {
      "//": "Object truncated mid-key (short string header but data missing)",
      "name": "object_truncated_after_key_start",
      "type": "decode_error",
      "input_bytes": "b866",
      "expected_error": "truncated"
    },
    {
      "//": "Object with value but missing key (integer where key expected)",
      "name": "object_value_without_key",
      "type": "decode_error",
      "input_bytes": "b801b6",
      "expected_error": "invalid_object_key"
    },
    {
      "//": "=== Trailing bytes edge cases ===",
      "//note": "Extra data after a complete document"
    },
    {
      "//": "Extra data after valid empty array",
      "name": "trailing_after_empty_array",
      "type": "decode_error",
      "input_bytes": "b7b600",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Extra data after array with element",
      "name": "trailing_after_array_with_element",
      "type": "decode_error",
      "input_bytes": "b701b600",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Extra data after valid empty object",
      "name": "trailing_after_empty_object",
      "type": "decode_error",
      "input_bytes": "b8b600",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Reserved type code at top level",
      "name": "reserved_type_code_c0_toplevel",
      "type": "decode_error",
      "input_bytes": "c0",
      "expected_error": "invalid_type_code"
    }
  ]
}
