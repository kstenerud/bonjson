{
  "type": "bonjson-test",
  "version": "1.0.0",
  "//": "Security-related tests for handling malicious or malformed input",
  "tests": [
    {
      "//": "Duplicate key detection - exact duplicate",
      "name": "duplicate_key_simple",
      "type": "decode_error",
      "input_bytes": "b8666101666102b6",
      "expected_error": "duplicate_key"
    },
    {
      "//": "Duplicate key with longer key name",
      "name": "duplicate_key_longer",
      "type": "decode_error",
      "input_bytes": "b868414243016841424302b6",
      "expected_error": "duplicate_key"
    },
    {
      "//": "Invalid UTF-8 sequences in strings",
      "name": "invalid_utf8_continuation_without_start",
      "type": "decode_error",
      "input_bytes": "ff80ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Incomplete 2-byte UTF-8 sequence",
      "name": "invalid_utf8_incomplete_2byte",
      "type": "decode_error",
      "input_bytes": "ffc0ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Incomplete 3-byte UTF-8 sequence",
      "name": "invalid_utf8_incomplete_3byte",
      "type": "decode_error",
      "input_bytes": "ffe080ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Incomplete 4-byte UTF-8 sequence",
      "name": "invalid_utf8_incomplete_4byte",
      "type": "decode_error",
      "input_bytes": "fff08080ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Overlong UTF-8 encoding of NUL",
      "name": "invalid_utf8_overlong_nul",
      "type": "decode_error",
      "input_bytes": "ffc080ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Overlong 3-byte UTF-8 encoding",
      "name": "invalid_utf8_overlong_3byte",
      "type": "decode_error",
      "input_bytes": "ffe08080ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "UTF-16 surrogate (invalid in UTF-8)",
      "name": "invalid_utf8_surrogate",
      "type": "decode_error",
      "input_bytes": "ffeda080ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Codepoint above U+10FFFF",
      "name": "invalid_utf8_above_max",
      "type": "decode_error",
      "input_bytes": "fff4908080ff",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Trailing bytes - rejected by default",
      "name": "trailing_bytes_after_integer",
      "type": "decode_error",
      "input_bytes": "00ff",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Short string 'a' (0x66 = 0x65+1) followed by trailing byte 0x64",
      "name": "trailing_bytes_after_string",
      "type": "decode_error",
      "input_bytes": "666164",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Object with key 'a' value true, followed by trailing byte 0x00",
      "name": "trailing_bytes_after_object",
      "type": "decode_error",
      "input_bytes": "b86661b5b600",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Trailing bytes - allowed with option",
      "name": "trailing_bytes_allowed",
      "type": "decode",
      "input_bytes": "00ffffff",
      "expected_value": 0,
      "options": {
        "allow_trailing_bytes": true
      },
      "_convert_error": "convert failed: Trailing bytes: consumed 1/4"
    },
    {
      "//": "Maximum nesting depth exceeded (6 nested arrays, limit 5)",
      "//note": "Each array: f8 + count. Inner arrays have 1 element (\u21920x04), innermost is empty (\u21920x00)",
      "name": "max_depth_exceeded_arrays",
      "type": "decode_error",
      "input_bytes": "b7b7b7b7b7b7b6b6b6b6b6b6",
      "expected_error": "max_depth_exceeded",
      "options": {
        "max_depth": 5
      }
    },
    {
      "//": "6 nested objects with empty string keys, limit 5",
      "name": "max_depth_exceeded_objects",
      "type": "decode_error",
      "input_bytes": "b865b865b865b865b865b8b6b6b6b6b6b6",
      "expected_error": "max_depth_exceeded",
      "options": {
        "max_depth": 5
      }
    },
    {
      "//": "At the limit is OK (depth 5 means 5 nested containers allowed)",
      "//note": "5 nested arrays, innermost contains integer 0",
      "name": "max_depth_at_limit",
      "type": "decode",
      "input_bytes": "b7b7b7b7b700b6b6b6b6b6",
      "expected_value": [
        [
          [
            [
              [
                0
              ]
            ]
          ]
        ]
      ],
      "options": {
        "max_depth": 5
      }
    },
    {
      "//": "Maximum string length exceeded - 25-byte string with limit 20",
      "name": "max_string_length_exceeded",
      "type": "decode_error",
      "input_bytes": "ff6162636465666768696a6b6c6d6e6f70717273747576777879ff",
      "expected_error": "max_string_length_exceeded",
      "options": {
        "max_string_length": 20
      }
    },
    {
      "//": "At the limit is OK - 20-byte string with limit 20",
      "name": "max_string_length_at_limit",
      "type": "decode",
      "input_bytes": "ff6162636465666768696a6b6c6d6e6f7071727374ff",
      "expected_value": "abcdefghijklmnopqrst",
      "options": {
        "max_string_length": 20
      }
    },
    {
      "//": "Maximum container size exceeded - array",
      "name": "max_container_size_exceeded_array",
      "type": "decode_error",
      "input_bytes": "b7 00 01 02 03 04 05 b6",
      "expected_error": "max_container_size_exceeded",
      "options": {
        "max_container_size": 5
      }
    },
    {
      "//": "Maximum container size exceeded - object",
      "name": "max_container_size_exceeded_object",
      "type": "decode_error",
      "input_bytes": "b8666100666201666302666403666504666605b6",
      "expected_error": "max_container_size_exceeded",
      "options": {
        "max_container_size": 5
      }
    },
    {
      "//": "At the limit is OK - array",
      "name": "container_size_at_limit_array",
      "type": "decode",
      "input_bytes": "b70001020304b6",
      "expected_value": [
        0,
        1,
        2,
        3,
        4
      ],
      "options": {
        "max_container_size": 5
      }
    },
    {
      "//": "At the limit is OK - object",
      "name": "container_size_at_limit_object",
      "type": "decode",
      "input_bytes": "b8666100666201666302666403666504b6",
      "expected_value": {
        "a": 0,
        "b": 1,
        "c": 2,
        "d": 3,
        "e": 4
      },
      "options": {
        "max_container_size": 5
      }
    },
    {
      "//": "Maximum document size exceeded (10 elements, total 12 bytes)",
      "name": "max_document_size_exceeded",
      "type": "decode_error",
      "input_bytes": "b700010203040506070809b6",
      "expected_error": "max_document_size_exceeded",
      "options": {
        "max_document_size": 10
      }
    },
    {
      "//": "At the limit is OK (4 elements, total 6 bytes)",
      "name": "document_size_at_limit",
      "type": "decode",
      "input_bytes": "b700010203b6",
      "expected_value": [
        0,
        1,
        2,
        3
      ],
      "options": {
        "max_document_size": 6
      }
    },
    {
      "//": "NUL allowed with option",
      "name": "nul_in_string_allowed",
      "type": "decode",
      "input_bytes": "676100",
      "expected_value": "a\u0000",
      "options": {
        "allow_nul": true
      }
    },
    {
      "//": "Multiple NUL characters allowed",
      "name": "multiple_nul_allowed",
      "type": "decode",
      "input_bytes": "6900610062",
      "expected_value": "\u0000a\u0000b",
      "options": {
        "allow_nul": true
      }
    },
    {
      "//": "NaN allowed with option (float32 NaN = 0xB0 + 7FC00000 LE)",
      "name": "nan_allowed",
      "type": "decode",
      "input_bytes": "b00000c07f",
      "expected_value": {
        "$number": "NaN"
      },
      "options": {
        "nan_infinity_behavior": "allow"
      }
    },
    {
      "//": "Positive Infinity allowed with option (float32 +Inf = 0xB0 + 7F800000 LE)",
      "name": "infinity_allowed",
      "type": "decode",
      "input_bytes": "b00000807f",
      "expected_value": {
        "$number": "Infinity"
      },
      "options": {
        "nan_infinity_behavior": "allow"
      }
    },
    {
      "//": "Negative Infinity allowed with option (float32 -Inf = 0xB0 + FF800000 LE)",
      "name": "neg_infinity_allowed",
      "type": "decode",
      "input_bytes": "b0000080ff",
      "expected_value": {
        "$number": "-Infinity"
      },
      "options": {
        "nan_infinity_behavior": "allow"
      }
    },
    {
      "//": "NaN converted to string with stringify option",
      "name": "nan_stringify",
      "type": "decode",
      "input_bytes": "b00000c07f",
      "expected_value": "NaN",
      "options": {
        "nan_infinity_behavior": "stringify"
      },
      "requires": [
        "nan_infinity_stringify"
      ]
    },
    {
      "//": "Positive Infinity converted to string with stringify option",
      "name": "infinity_stringify",
      "type": "decode",
      "input_bytes": "b00000807f",
      "expected_value": "Infinity",
      "options": {
        "nan_infinity_behavior": "stringify"
      },
      "requires": [
        "nan_infinity_stringify"
      ]
    },
    {
      "//": "Negative Infinity converted to string with stringify option",
      "name": "neg_infinity_stringify",
      "type": "decode",
      "input_bytes": "b0000080ff",
      "expected_value": "-Infinity",
      "options": {
        "nan_infinity_behavior": "stringify"
      },
      "requires": [
        "nan_infinity_stringify"
      ]
    },
    {
      "//": "=== Duplicate key handling modes ===",
      "//note": "keep_first silently ignores subsequent duplicates",
      "name": "dup_key_keep_first",
      "type": "decode",
      "input_bytes": "b8666101666102b6",
      "expected_value": {
        "a": 1
      },
      "options": {
        "duplicate_key": "keep_first"
      }
    },
    {
      "//": "keep_last replaces with latest value",
      "name": "dup_key_keep_last",
      "type": "decode",
      "input_bytes": "b8666101666102b6",
      "expected_value": {
        "a": 2
      },
      "options": {
        "duplicate_key": "keep_last"
      }
    },
    {
      "//": "Multiple duplicates with keep_first",
      "name": "dup_key_keep_first_multiple",
      "type": "decode",
      "input_bytes": "b8666101666102666103b6",
      "expected_value": {
        "a": 1
      },
      "options": {
        "duplicate_key": "keep_first"
      }
    },
    {
      "//": "Multiple duplicates with keep_last",
      "name": "dup_key_keep_last_multiple",
      "type": "decode",
      "input_bytes": "b8666101666102666103b6",
      "expected_value": {
        "a": 3
      },
      "options": {
        "duplicate_key": "keep_last"
      }
    },
    {
      "//": "=== Invalid UTF-8 handling modes ===",
      "//note": "replace mode substitutes invalid bytes with U+FFFD",
      "name": "invalid_utf8_replace",
      "type": "decode",
      "input_bytes": "6961806263",
      "expected_value": "a\ufffdbc",
      "options": {
        "invalid_utf8": "replace"
      }
    },
    {
      "//": "delete mode removes invalid bytes",
      "name": "invalid_utf8_delete",
      "type": "decode",
      "input_bytes": "6961806263",
      "expected_value": "abc",
      "options": {
        "invalid_utf8": "delete"
      }
    },
    {
      "//": "Multiple invalid bytes with replace",
      "name": "invalid_utf8_replace_multiple",
      "type": "decode",
      "input_bytes": "6a8061ff62fe",
      "expected_value": "\ufffda\ufffdb\ufffd",
      "options": {
        "invalid_utf8": "replace"
      }
    },
    {
      "//": "Multiple invalid bytes with delete",
      "name": "invalid_utf8_delete_multiple",
      "type": "decode",
      "input_bytes": "6a8061ff62fe",
      "expected_value": "ab",
      "options": {
        "invalid_utf8": "delete"
      }
    }
  ]
}
