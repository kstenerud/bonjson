{
  "type": "bonjson-test",
  "version": "1.0.0",
  "//": "Security-related tests for handling malicious or malformed input",
  "tests": [
    {
      "//": "Duplicate key detection - exact duplicate",
      "name": "duplicate_key_simple",
      "type": "decode_error",
      "input_bytes": "9a8161018161029b",
      "expected_error": "duplicate_key"
    },
    {
      "//": "Duplicate key with longer key name",
      "name": "duplicate_key_longer",
      "type": "decode_error",
      "input_bytes": "9a834142430183414243029b",
      "expected_error": "duplicate_key"
    },
    {
      "//": "Invalid UTF-8 sequences in strings",
      "name": "invalid_utf8_continuation_without_start",
      "type": "decode_error",
      "input_bytes": "680480",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Incomplete 2-byte UTF-8 sequence",
      "name": "invalid_utf8_incomplete_2byte",
      "type": "decode_error",
      "input_bytes": "6804c0",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Incomplete 3-byte UTF-8 sequence",
      "name": "invalid_utf8_incomplete_3byte",
      "type": "decode_error",
      "input_bytes": "6808e080",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Incomplete 4-byte UTF-8 sequence",
      "name": "invalid_utf8_incomplete_4byte",
      "type": "decode_error",
      "input_bytes": "680cf08080",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Overlong UTF-8 encoding of NUL",
      "name": "invalid_utf8_overlong_nul",
      "type": "decode_error",
      "input_bytes": "6808c080",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Overlong 3-byte UTF-8 encoding",
      "name": "invalid_utf8_overlong_3byte",
      "type": "decode_error",
      "input_bytes": "680ce08080",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "UTF-16 surrogate (invalid in UTF-8)",
      "name": "invalid_utf8_surrogate",
      "type": "decode_error",
      "input_bytes": "680ceda080",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Codepoint above U+10FFFF",
      "name": "invalid_utf8_above_max",
      "type": "decode_error",
      "input_bytes": "6810f4908080",
      "expected_error": "invalid_utf8"
    },
    {
      "//": "Empty chunk with continuation bit set - invalid (potential DoS)",
      "name": "empty_chunk_with_continuation",
      "type": "decode_error",
      "input_bytes": "6802",
      "expected_error": "empty_chunk_continuation"
    },
    {
      "//": "Empty chunk without continuation is valid (empty long string)",
      "name": "empty_chunk_without_continuation",
      "type": "decode",
      "input_bytes": "6800",
      "expected_value": ""
    },
    {
      "//": "Valid string chunking round-trip",
      "name": "roundtrip_valid_chunked_string",
      "type": "roundtrip",
      "input": "this is a test string that might get chunked"
    },
    {
      "//": "Small integer boundary tests - verify encoding size",
      "name": "boundary_neg101_uses_2_bytes",
      "type": "encode",
      "input": -101,
      "expected_bytes": "789b"
    },
    {
      "//": "-100 uses single byte (small integer)",
      "name": "boundary_neg100_uses_1_byte",
      "type": "encode",
      "input": -100,
      "expected_bytes": "9c"
    },
    {
      "//": "100 uses single byte (small integer)",
      "name": "boundary_100_uses_1_byte",
      "type": "encode",
      "input": 100,
      "expected_bytes": "64"
    },
    {
      "//": "101 uses 2 bytes (sint8)",
      "name": "boundary_101_uses_2_bytes",
      "type": "encode",
      "input": 101,
      "expected_bytes": "7865"
    },
    {
      "//": "Short string boundary tests",
      "name": "boundary_string_15_uses_short_encoding",
      "type": "encode",
      "input": "123456789012345",
      "expected_bytes": "8f313233343536373839303132333435"
    },
    {
      "//": "16-byte string uses long encoding",
      "name": "boundary_string_16_uses_long_encoding",
      "type": "encode",
      "input": "1234567890123456",
      "expected_bytes": "684031323334353637383930313233343536"
    },
    {
      "//": "Unicode strings should round-trip correctly",
      "name": "roundtrip_unicode_cjk",
      "type": "roundtrip",
      "input": "\u65e5\u672c\u8a9e\u30c6\u30b9\u30c8"
    },
    {
      "name": "roundtrip_unicode_emoji",
      "type": "roundtrip",
      "input": "\ud83d\ude00\ud83c\udf89\ud83c\udf0d"
    },
    {
      "//": "Deep nesting round-trip (within reasonable limits)",
      "name": "roundtrip_deep_array_nesting",
      "type": "roundtrip",
      "input": [[[[[[[[[[1]]]]]]]]]]
    },
    {
      "name": "roundtrip_deep_object_nesting",
      "type": "roundtrip",
      "input": {"a": {"b": {"c": {"d": {"e": {"f": {"g": {"h": {"i": {"j": 1}}}}}}}}}}
    },
    {
      "//": "Large but valid structures",
      "name": "roundtrip_array_many_elements",
      "type": "roundtrip",
      "input": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
    },
    {
      "name": "roundtrip_object_many_keys",
      "type": "roundtrip",
      "input": {"a": 1, "b": 2, "c": 3, "d": 4, "e": 5, "f": 6, "g": 7, "h": 8, "i": 9, "j": 10}
    },
    {
      "//": "Trailing bytes - rejected by default",
      "name": "trailing_bytes_after_integer",
      "type": "decode_error",
      "input_bytes": "00 ff",
      "expected_error": "trailing_bytes"
    },
    {
      "name": "trailing_bytes_after_string",
      "type": "decode_error",
      "input_bytes": "81 61 00",
      "expected_error": "trailing_bytes"
    },
    {
      "name": "trailing_bytes_after_object",
      "type": "decode_error",
      "input_bytes": "9a 9b ff",
      "expected_error": "trailing_bytes"
    },
    {
      "//": "Trailing bytes - allowed with option",
      "name": "trailing_bytes_allowed",
      "type": "decode",
      "input_bytes": "00 ff ff ff",
      "expected_value": 0,
      "options": {"allow_trailing_bytes": true}
    },
    {
      "//": "Non-canonical length encoding - length 0 encoded as 2 bytes instead of 1",
      "name": "non_canonical_length_zero",
      "type": "decode_error",
      "input_bytes": "68 01 00",
      "expected_error": "non_canonical_length"
    },
    {
      "//": "Non-canonical length - payload 2 (length 1) encoded with 2 bytes instead of 1",
      "name": "non_canonical_length_small_value",
      "type": "decode_error",
      "input_bytes": "68 09 00 61",
      "expected_error": "non_canonical_length"
    },
    {
      "//": "Maximum nesting depth exceeded",
      "name": "max_depth_exceeded_arrays",
      "type": "decode_error",
      "input_bytes": "99 99 99 99 99 99 00 9b 9b 9b 9b 9b 9b",
      "expected_error": "max_depth_exceeded",
      "options": {"max_depth": 5}
    },
    {
      "name": "max_depth_exceeded_objects",
      "type": "decode_error",
      "input_bytes": "9a 80 9a 80 9a 80 9a 80 9a 80 9a 80 00 9b 9b 9b 9b 9b 9b",
      "expected_error": "max_depth_exceeded",
      "options": {"max_depth": 5}
    },
    {
      "//": "At the limit is OK (depth 5 means 5 nested containers allowed)",
      "name": "max_depth_at_limit",
      "type": "decode",
      "input_bytes": "99 99 99 99 99 00 9b 9b 9b 9b 9b",
      "expected_value": [[[[[0]]]]],
      "options": {"max_depth": 5}
    },
    {
      "//": "Maximum string length exceeded - 25-byte string with limit 20",
      "name": "max_string_length_exceeded",
      "type": "decode_error",
      "input_bytes": "68 64 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74 75 76 77 78 79",
      "expected_error": "max_string_length_exceeded",
      "options": {"max_string_length": 20}
    },
    {
      "//": "At the limit is OK - 20-byte string with limit 20",
      "name": "max_string_length_at_limit",
      "type": "decode",
      "input_bytes": "68 50 61 62 63 64 65 66 67 68 69 6a 6b 6c 6d 6e 6f 70 71 72 73 74",
      "expected_value": "abcdefghijklmnopqrst",
      "options": {"max_string_length": 20}
    },
    {
      "//": "Too many chunks",
      "name": "too_many_chunks",
      "type": "decode_error",
      "input_bytes": "68 06 61 06 62 06 63 06 64 04 65",
      "expected_error": "too_many_chunks",
      "options": {"max_chunks": 4}
    },
    {
      "//": "At the limit is OK",
      "name": "chunks_at_limit",
      "type": "decode",
      "input_bytes": "68 06 61 06 62 06 63 04 64",
      "expected_value": "abcd",
      "options": {"max_chunks": 4}
    },
    {
      "//": "Maximum container size exceeded - array",
      "name": "max_container_size_exceeded_array",
      "type": "decode_error",
      "input_bytes": "99 00 01 02 03 04 05 9b",
      "expected_error": "max_container_size_exceeded",
      "options": {"max_container_size": 5}
    },
    {
      "//": "Maximum container size exceeded - object (each key-value pair counts as 1)",
      "name": "max_container_size_exceeded_object",
      "type": "decode_error",
      "input_bytes": "9a 81 61 00 81 62 01 81 63 02 81 64 03 81 65 04 81 66 05 9b",
      "expected_error": "max_container_size_exceeded",
      "options": {"max_container_size": 5}
    },
    {
      "//": "At the limit is OK - array",
      "name": "container_size_at_limit_array",
      "type": "decode",
      "input_bytes": "99 00 01 02 03 04 9b",
      "expected_value": [0, 1, 2, 3, 4],
      "options": {"max_container_size": 5}
    },
    {
      "//": "At the limit is OK - object",
      "name": "container_size_at_limit_object",
      "type": "decode",
      "input_bytes": "9a 81 61 00 81 62 01 81 63 02 81 64 03 81 65 04 9b",
      "expected_value": {"a": 0, "b": 1, "c": 2, "d": 3, "e": 4},
      "options": {"max_container_size": 5}
    },
    {
      "//": "Maximum document size exceeded",
      "name": "max_document_size_exceeded",
      "type": "decode_error",
      "input_bytes": "99 00 01 02 03 04 05 06 07 08 09 9b",
      "expected_error": "max_document_size_exceeded",
      "options": {"max_document_size": 10}
    },
    {
      "//": "At the limit is OK",
      "name": "document_size_at_limit",
      "type": "decode",
      "input_bytes": "99 00 01 02 03 9b",
      "expected_value": [0, 1, 2, 3],
      "options": {"max_document_size": 6}
    }
  ]
}
